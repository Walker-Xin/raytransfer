void metric(long double r, long double th, long double g[4][4])
{
long double t2 = pow(spin,2);
long double t1 = pow(r,2);
long double t9 = sin(th);
long double t11 = pow(t9,2);
long double t14 = pow(r,-3);
long double t3 = cos(th);
long double t4 = pow(t3,2);
long double t5 = t2*t4;
long double t6 = t1 + t5;
long double t15 = defpar*t14;
long double t16 = 1 + t15;
long double t17 = t1 + t2;
long double t18 = t16*t17;
long double t19 = -2*t11*t2;
long double t20 = t18 + t19;
long double t21 = pow(t20,-2);
long double t23 = 1/r;
long double t24 = 2*defpar*t23;
long double t25 = 2 + r;
long double t26 = r*t25;
long double t27 = 2*defpar*t14;
long double t28 = 1 + t27;
long double t29 = t2*t28;
long double t30 = t24 + t26 + t29;
long double t31 = -(spin*t11*t21*t30*t6);
long double t7 = -2 + r;
long double t8 = r*t7;
g[0][0] = t21*t6*(t2 - 4*t11*t2 + t8);
g[0][1] = 0;
g[0][2] = 0;
g[0][3] = t31;
g[1][0] = 0;
g[1][1] = t6/(-2*r + t1 + t2);
g[1][2] = 0;
g[1][3] = 0;
g[2][0] = 0;
g[2][1] = 0;
g[2][2] = t6;
g[2][3] = 0;
g[3][0] = t31;
g[3][1] = 0;
g[3][2] = 0;
g[3][3] = t11*t21*t6*(pow(t16,2)*pow(t17,2) - t11*t2*(t2 + t8));
}

void uppermetric(long double r, long double th, long double gu[4][4])
{
long double t1 = pow(r,2);
long double t2 = pow(spin,2);
long double t8 = pow(r,-3);
long double t9 = defpar*t8;
long double t11 = 1 + t9;
long double t12 = t1 + t2;
long double t14 = sin(th);
long double t15 = pow(t14,2);
long double t22 = -2 + r;
long double t23 = r*t22;
long double t19 = pow(t11,2);
long double t20 = pow(t12,2);
long double t21 = t19*t20;
long double t24 = t2 + t23;
long double t25 = -(t15*t2*t24);
long double t26 = t21 + t25;
long double t29 = 2 + r;
long double t3 = cos(th);
long double t4 = pow(t3,2);
long double t5 = t2*t4;
long double t6 = t1 + t5;
long double t7 = 1/t6;
long double t47 = pow(r,3);
long double t44 = pow(r,4);
long double t62 = pow(defpar,2);
long double t67 = 3*r;
long double t63 = 4*t62;
long double t65 = pow(r,6);
long double t66 = 3*t65;
long double t81 = pow(spin,4);
long double t43 = 2*defpar*t1;
long double t45 = t29*t44;
long double t46 = 2*defpar;
long double t48 = t46 + t47;
long double t49 = t2*t48;
long double t50 = t43 + t45 + t49;
long double t51 = defpar*t1;
long double t52 = pow(r,5);
long double t53 = defpar*t2;
long double t54 = 2*th;
long double t55 = cos(t54);
long double t56 = t2*t47*t55;
long double t57 = t51 + t52 + t53 + t56;
long double t58 = pow(t57,2);
long double t59 = defpar + t47;
long double t60 = pow(t59,2);
long double t61 = t20*t24*t60;
long double t64 = 4*t44;
long double t68 = 2 + t67;
long double t69 = 2*defpar*t1*t68;
long double t70 = t63 + t64 + t66 + t69;
long double t71 = t44*t70;
long double t72 = 4*t1*t62;
long double t73 = pow(r,8);
long double t74 = 3*t73;
long double t75 = 1 + t67;
long double t76 = 2*defpar*t44*t75;
long double t77 = t72 + t74 + t76;
long double t78 = 2*t2*t77;
long double t79 = 6*defpar*t47;
long double t80 = t63 + t66 + t79;
long double t82 = t80*t81;
long double t83 = t71 + t78 + t82;
long double t84 = -2*t15*t2*t83;
long double t85 = pow(t14,4);
long double t86 = 4*t24*t65*t81*t85;
long double t87 = t61 + t84 + t86;
long double t88 = 1/t87;
long double t89 = spin*t50*t58*t7*t8*t88;
gu[0][0] = (pow(t11*t12 - 2*t15*t2,2)*t26*t7)/((t2 - 4*t15*t2 + t23)*t26 - t15*t2*pow((2*defpar)/r + r*t29 + t2*(1 + 2*defpar*t8),2));
gu[0][1] = 0;
gu[0][2] = 0;
gu[0][3] = t89;
gu[1][0] = 0;
gu[1][1] = (-2*r + t1 + t2)*t7;
gu[1][2] = 0;
gu[1][3] = 0;
gu[2][0] = 0;
gu[2][1] = 0;
gu[2][2] = t7;
gu[2][3] = 0;
gu[3][0] = t89;
gu[3][1] = 0;
gu[3][2] = 0;
gu[3][3] = (-t2 + t23 + 2*t2*t55)*t58*t7*t88*pow(1/sin(th),2);
}

void metric_rderivatives(long double r, long double th, long double dg[4][4])
{
long double t5 = pow(spin,2);
long double t4 = pow(r,2);
long double t8 = sin(th);
long double t9 = pow(t8,2);
long double t20 = cos(th);
long double t21 = pow(t20,2);
long double t22 = t21*t5;
long double t23 = t22 + t4;
long double t1 = pow(r,-3);
long double t2 = defpar*t1;
long double t3 = 1 + t2;
long double t6 = t4 + t5;
long double t7 = t3*t6;
long double t11 = -2*t5*t9;
long double t12 = t11 + t7;
long double t24 = -2 + r;
long double t25 = r*t24;
long double t26 = -4*t5*t9;
long double t27 = t25 + t26 + t5;
long double t13 = pow(t12,-3);
long double t16 = pow(r,5);
long double t42 = 2 + r;
long double t14 = pow(r,-4);
long double t67 = -r;
long double t29 = 2*r;
long double t35 = pow(r,-7);
long double t36 = defpar*t4;
long double t37 = -2*t16;
long double t38 = 3*defpar*t5;
long double t39 = t36 + t37 + t38;
long double t40 = 2*defpar*t4;
long double t41 = pow(r,4);
long double t43 = t41*t42;
long double t44 = 2*defpar;
long double t45 = pow(r,3);
long double t46 = t44 + t45;
long double t47 = t46*t5;
long double t48 = t40 + t43 + t47;
long double t49 = -2*t23*t35*t39*t48;
long double t50 = 1/r;
long double t51 = 2*defpar*t50;
long double t52 = r*t42;
long double t53 = 2*defpar*t1;
long double t54 = 1 + t53;
long double t55 = t5*t54;
long double t56 = t51 + t52 + t55;
long double t57 = -2*r*t12*t56;
long double t58 = 3*t5;
long double t59 = t4 + t58;
long double t60 = -(defpar*t14*t59);
long double t61 = 1 + r + t60;
long double t62 = -2*t12*t23*t61;
long double t63 = t49 + t57 + t62;
long double t64 = spin*t13*t63*t9;
long double t70 = 1 + t67;
long double t65 = t25 + t5;
long double t80 = defpar + t45;
long double t88 = pow(t6,2);
dg[0][0] = t13*(2*r*t12*t27 + t12*t23*(-2 + t29) - 2*t14*t23*t27*(2*t16 - defpar*t4 - 3*defpar*t5));
dg[0][1] = 0;
dg[0][2] = 0;
dg[0][3] = t64;
dg[1][0] = 0;
dg[1][1] = (2*(r*(t5 + t67) + t21*t5*t70))/pow(t65,2);
dg[1][2] = 0;
dg[1][3] = 0;
dg[2][0] = 0;
dg[2][1] = 0;
dg[2][2] = t29;
dg[2][3] = 0;
dg[3][0] = t64;
dg[3][1] = 0;
dg[3][2] = 0;
dg[3][3] = (2*t13*t9*(pow(r,11)*t12*(pow(t3,2)*t88 - t5*t65*t9) + t23*t39*(pow(t80,2)*t88 - pow(r,6)*t5*t65*t9) + t23*(-(t39*t6*t80) + pow(r,7)*t5*t70*t9)*(t16 + t36 + defpar*t5 + t45*t5*cos(2*th))))/pow(r,10);
}

void metric_r2derivatives(long double r, long double th, long double dg2[4][4])
{
long double t5 = pow(spin,2);
long double t4 = pow(r,5);
long double t7 = pow(r,3);
long double t18 = pow(r,6);
long double t19 = 3*r;
long double t14 = pow(defpar,2);
long double t8 = 2*th;
long double t9 = cos(t8);
long double t46 = pow(spin,4);
long double t1 = pow(r,4);
long double t2 = pow(r,2);
long double t48 = 5*defpar;
long double t49 = -2*t7;
long double t50 = t48 + t49;
long double t72 = -3*r;
long double t43 = pow(r,7);
long double t100 = 2*r;
long double t101 = 3 + t100;
long double t51 = pow(spin,6);
long double t3 = defpar*t2;
long double t6 = defpar*t5;
long double t11 = t5*t7*t9;
long double t12 = t11 + t3 + t4 + t6;
long double t13 = pow(t12,-4);
long double t63 = pow(r,8);
long double t119 = pow(defpar,3);
long double t123 = pow(r,11);
long double t131 = pow(r,9);
long double t121 = pow(r,10);
long double t125 = pow(r,13);
long double t106 = pow(spin,8);
long double t94 = 9*r;
long double t15 = -5*r;
long double t37 = -24*r;
long double t38 = 7 + t37;
long double t69 = 4*th;
long double t70 = cos(t69);
long double t112 = 6*th;
long double t113 = cos(t112);
long double t156 = 6*r;
long double t120 = -48*t119*t63;
long double t122 = -160*t121*t14;
long double t124 = 168*t123*t14;
long double t126 = 256*defpar*t125;
long double t127 = pow(r,16);
long double t128 = -16*t127;
long double t129 = -192*t119*t18*t5;
long double t130 = -568*t14*t5*t63;
long double t132 = 600*t131*t14*t5;
long double t133 = 752*defpar*t123*t5;
long double t134 = pow(r,12);
long double t135 = 96*defpar*t134*t5;
long double t136 = pow(r,14);
long double t137 = -48*t136*t5;
long double t138 = pow(r,15);
long double t139 = -36*t138*t5;
long double t140 = -296*t1*t119*t46;
long double t141 = -672*t14*t18*t46;
long double t142 = 564*t14*t43*t46;
long double t143 = 384*defpar*t131*t46;
long double t144 = 344*defpar*t121*t46;
long double t145 = -48*t125*t46;
long double t146 = -176*t119*t2*t51;
long double t147 = -168*t1*t14*t51;
long double t148 = 48*t14*t4*t51;
long double t149 = 24*defpar*t43*t51;
long double t150 = 100*defpar*t51*t63;
long double t151 = -2*t123*t51;
long double t152 = -24*t106*t119;
long double t153 = 12*t106*t14*t7;
long double t154 = 1 + t72;
long double t155 = 6*t14*t154;
long double t157 = 1 + t156;
long double t158 = 4*defpar*t157*t7;
long double t159 = 20 + t94;
long double t160 = -(t159*t18);
long double t161 = t155 + t158 + t160;
long double t162 = 4*t161*t63;
long double t163 = 2*t119;
long double t164 = 3 + t15;
long double t165 = 16*defpar*t164*t4;
long double t166 = 7*r;
long double t167 = 6 + t166;
long double t168 = 2*t167*t63;
long double t169 = 109*r;
long double t170 = -24 + t169;
long double t171 = t14*t170*t2;
long double t172 = t163 + t165 + t168 + t171;
long double t173 = -4*t1*t172*t5;
long double t174 = 16*t119;
long double t175 = 24*t14*t2*t38;
long double t176 = -5*t131;
long double t177 = 24 + r;
long double t178 = -2*defpar*t177*t4;
long double t179 = t174 + t175 + t176 + t178;
long double t180 = t179*t2*t46;
long double t181 = 2*t14;
long double t182 = -7*defpar*t7;
long double t183 = -t18;
long double t184 = t181 + t182 + t183;
long double t185 = 12*defpar*t184*t51;
long double t186 = t162 + t173 + t180 + t185;
long double t187 = -(t186*t5*t9);
long double t188 = -t14;
long double t189 = 3*defpar*t7;
long double t190 = t18 + t188 + t189;
long double t191 = -4*t1*t190;
long double t192 = 24*t14*t2;
long double t193 = -25*r;
long double t194 = 6 + t193;
long double t195 = 2*defpar*t1*t194;
long double t196 = -t63;
long double t197 = t192 + t195 + t196;
long double t198 = t197*t5;
long double t199 = 36*t14*t46;
long double t200 = t191 + t198 + t199;
long double t201 = 2*t200*t46*t7*t70;
long double t202 = -2*defpar*t113*t51*t63;
long double t203 = -(t113*t123*t51);
long double t204 = -12*defpar*t106*t113*t18;
long double t205 = t120 + t122 + t124 + t126 + t128 + t129 + t130 + t132 + t133 + t135 + t137 + t139 + t140 + t141 + t142 + t143 + t144 + t145 + t146 + t147 + t148 + t149 + t150 + t151 + t152 + t153 + t187 + t201 + t202 + t203 + t204;
long double t206 = sin(th);
long double t207 = pow(t206,2);
long double t208 = (r*spin*t13*t205*t207)/4.;
long double t222 = pow(defpar,4);
long double t226 = pow(r,17);
long double t259 = pow(spin,10);
long double t27 = -4*r;
long double t28 = 1 + t27;
long double t213 = 2*t7;
long double t16 = 1 + t15;
long double t17 = -6*t14*t16;
long double t22 = 27*r;
long double t262 = 4*t119;
dg2[0][0] = (t1*t13*(2*t46*(6*defpar*t46*t50 + t5*(4*defpar*(3 - 23*r)*t1 + 8*t14*t2 - 3*t63) + 2*t1*(t14 - 4*t18 - 6*defpar*t7))*t70 + t5*(12*defpar*t50*t51 + r*t46*(-24*t14*t38 + 11*t43 + 4*defpar*(12 - 53*r)*t7) + 4*t4*(t17 + t18*(20 + t19) - 2*defpar*(2 + t22)*t7) + 12*t5*t7*((-8 + 37*r)*t14 + 2*t18*(2 + t19) + 16*defpar*t28*t7))*t9 - r*(24*defpar*t106*t2 + t113*t2*(4*defpar*t2 - t4 + 24*defpar*t5)*t51 + 4*t1*t5*(2*(71 - 45*r)*t14 + 3*(4 + r)*t18 + 2*defpar*(-94 + 21*r)*t7) + 2*t51*(28*t101*t14 + 3*t43 - 4*defpar*t101*t7) + 8*t18*(2*t18 + 5*t14*(4 + t72) - 4*defpar*t7*(8 + t72)) + 8*t2*t46*(2*(42 - 17*r)*t14 + 7*t43 - 3*defpar*t7*(16 + t94)))))/4.;
dg2[0][1] = 0;
dg2[0][2] = 0;
dg2[0][3] = t208;
dg2[1][0] = 0;
dg2[1][1] = (2*(t213 + t46 - 3*t2*t5 - t5*(-4 + t156 - 3*t2 + t5)*pow(cos(th),2)))/pow((-2 + r)*r + t5,3);
dg2[1][2] = 0;
dg2[1][3] = 0;
dg2[2][0] = 0;
dg2[2][1] = 0;
dg2[2][2] = 2;
dg2[2][3] = 0;
dg2[3][0] = t208;
dg2[3][1] = 0;
dg2[3][2] = 0;
dg2[3][3] = (t13*t207*(32*pow(r,20) + 128*t119*t123 - 152*defpar*t106*t131 + 16*defpar*t106*t113*t131 + 7*t106*t134 + 8*t106*t113*t134 + 192*t136*t14 + 256*t106*t14*t18 + 80*t106*t113*t14*t18 + 32*t106*t222 + 128*defpar*t226 + 48*r*t119*t259 + 60*t1*t14*t259 + 84*t1*t113*t14*t259 + 168*t106*t14*t4 + 24*defpar*t113*t259*t43 - 504*defpar*t125*t46 + 276*t127*t46 - 1520*defpar*t134*t46 + 176*t138*t46 - 1368*t121*t14*t46 + 1112*t131*t14*t46 + 192*t1*t222*t46 + 1152*t119*t43*t46 + 576*t119*t131*t5 - 512*defpar*t136*t5 - 64*defpar*t138*t5 + 320*t123*t14*t5 - 48*t134*t14*t5 + 128*t18*t222*t5 + 32*t226*t5 - 576*defpar*t121*t51 - 624*defpar*t123*t51 + 8*defpar*t113*t123*t51 + 48*t125*t51 + 120*t136*t51 + 32*t113*t136*t51 + 128*t2*t222*t51 + 1328*t119*t4*t51 + 1248*t14*t43*t51 + 24*defpar*t106*t113*t63 + 32*t222*t63 - 1092*t14*t51*t63 + 12*t113*t14*t51*t63 + 672*t106*t119*t7 - 4*r*t46*(-2*t2*(-4*t119 + t131 + 31*defpar*t18 + (-21 + 64*r)*t14*t2)*t46 - t1*t5*((-24 + 149*r)*t14*t2 + t262 + 4*defpar*(12 + 23*r)*t4 + 2*(6 + 5*r)*t63) + 3*t14*t51*(4*defpar + 5*t7) - t63*(t17 + (20 + 39*r)*t18 + 2*defpar*(-2 + t22)*t7))*t70 - 4*t5*t7*t9*(3*defpar*r*t106*(7*defpar + t213) + 4*t1*t5*(24*t119 + 2*(34 - 75*r)*t14*t2 - 6*defpar*(16 + 11*r)*t4 + (16 + 15*r)*t63) + t2*t46*(208*t119 + (288 - 313*r)*t14*t2 - 2*defpar*(48 + 95*r)*t4 + 8*t101*t63) + 2*t51*(64*t119 - t131 + defpar*(3 - 2*r)*t4 + 82*t14*t7) + 4*t18*((20 - 51*r)*t14*t2 + t262 + 2*t28*t63 - 4*defpar*t4*(8 + t94))) + t106*t134*cos(8*th)))/16.;
}