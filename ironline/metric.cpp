void metric(double r, double th, double g[4][4])
{
double t3 = pow(spin,2);
double t4 = 2*th;
double t5 = cos(t4);
double t6 = t3*t5;
double t8 = pow(r,2);
double t9 = 2*t8;
double t11 = t3 + t6 + t9;
double t12 = 1/t11;
double t14 = 1/r;
double t15 = (defpar*spin*t14)/2.;
double t22 = cos(th);
double t23 = pow(t22,2);
double t24 = t23*t3;
double t25 = t24 + t8;
double t16 = sin(th);
double t17 = pow(t16,2);
double t18 = -4*r*spin*t12*t17;
double t1 = -2 + r;
g[0][0] = -(t12*(2*r*t1 + t3 + t6));
g[0][1] = t15;
g[0][2] = 0;
g[0][3] = t18;
g[1][0] = t15;
g[1][1] = t25/(-2*r + t3 + t8);
g[1][2] = 0;
g[1][3] = 0;
g[2][0] = 0;
g[2][1] = 0;
g[2][2] = t25;
g[2][3] = 0;
g[3][0] = t18;
g[3][1] = 0;
g[3][2] = 0;
g[3][3] = (t17*t25*(-(t17*t3*(r*t1 + t3)) + pow(t3 + t8,2)))/pow(t3 - t17*t3 + t8,2);
}

void uppermetric(double r, double th, double gu[4][4])
{
double t1 = pow(r,2);
double t4 = pow(spin,2);
double t2 = -2 + r;
double t3 = r*t2;
double t5 = t3 + t4;
double t8 = 2*th;
double t9 = cos(t8);
double t13 = pow(r,4);
double t24 = pow(defpar,2);
double t18 = pow(spin,4);
double t14 = 2*t13;
double t15 = 3*r;
double t16 = 2 + t15;
double t17 = r*t16*t4;
double t19 = t4*t5*t9;
double t20 = t14 + t17 + t18 + t19;
double t21 = pow(r,6);
double t22 = 8*t21;
double t23 = 8*t13*t4;
double t25 = 2*t13*t24*t4;
double t26 = 2*r*t18*t24;
double t27 = 3*t1*t18;
double t28 = 3*t1*t18*t24;
double t29 = pow(spin,6);
double t30 = t24*t29;
double t31 = 8*t13;
double t32 = t2*t24;
double t33 = 4*r;
double t34 = t32 + t33;
double t35 = r*t34*t4;
double t36 = t18*t24;
double t37 = t31 + t35 + t36;
double t38 = t37*t4*t9;
double t39 = 4*th;
double t40 = cos(t39);
double t41 = t1*t18*t40;
double t42 = t22 + t23 + t25 + t26 + t27 + t28 + t30 + t38 + t41;
double t43 = 1/t42;
double t6 = 1/t5;
double t7 = 2*t1;
double t11 = t4*t9;
double t12 = t11 + t4 + t7;
double t45 = 2*defpar*r*spin*t20*t43;
double t46 = pow(r,3);
double t47 = -8*spin*t12*t43*t46*t6;
double t49 = 8*defpar*t1*t4*t43;
gu[0][0] = -2*t1*t12*t20*t43*t6;
gu[0][1] = t45;
gu[0][2] = 0;
gu[0][3] = t47;
gu[1][0] = t45;
gu[1][1] = 4*t1*t12*t43*t5;
gu[1][2] = 0;
gu[1][3] = t49;
gu[2][0] = 0;
gu[2][1] = 0;
gu[2][2] = 1/(t1 + t4*pow(cos(th),2));
gu[2][3] = 0;
gu[3][0] = t47;
gu[3][1] = t49;
gu[3][2] = 0;
gu[3][3] = t12*t43*t6*(t36 + r*(2*r + t32)*t4 + 4*t2*t46 + 2*t1*t4*t9)*pow(1/sin(th),2);
}

void metric_rderivatives(double r, double th, double dg[4][4])
{
double t3 = pow(spin,2);
double t1 = pow(r,2);
double t4 = 2*th;
double t5 = cos(t4);
double t6 = t3*t5;
double t2 = -2*t1;
double t7 = t2 + t3 + t6;
double t8 = 2*t1;
double t9 = t3 + t6 + t8;
double t11 = pow(t9,-2);
double t13 = pow(r,-2);
double t14 = -0.5*(defpar*spin*t13);
double t22 = -r;
double t15 = sin(th);
double t16 = pow(t15,2);
double t17 = -4*spin*t11*t16*t7;
double t37 = pow(spin,4);
double t31 = 2*r;
double t25 = 1 + t22;
dg[0][0] = 4*t11*t7;
dg[0][1] = t14;
dg[0][2] = 0;
dg[0][3] = t17;
dg[1][0] = t14;
dg[1][1] = (2*(r*(t22 + t3) + t25*t3*pow(cos(th),2)))/pow((-2 + r)*r + t3,2);
dg[1][2] = 0;
dg[1][3] = 0;
dg[2][0] = 0;
dg[2][1] = 0;
dg[2][2] = t31;
dg[2][3] = 0;
dg[3][0] = t17;
dg[3][1] = 0;
dg[3][2] = 0;
dg[3][3] = t11*t16*(8*pow(r,5) + 8*pow(r,3)*t3 - 4*t1*t3 + t37 + 3*r*t37 + 4*r*t3*(t3 + r*(1 + t31))*t5 - t25*t37*cos(4*th));
}

void metric_r2derivatives(double r, double th, double dg2[4][4])
{
double t3 = pow(spin,2);
double t1 = pow(r,2);
double t2 = 2*t1;
double t5 = 2*th;
double t6 = cos(t5);
double t9 = t3*t6;
double t11 = t2 + t3 + t9;
double t12 = pow(t11,-3);
double t14 = pow(r,-3);
double t15 = defpar*spin*t14;
double t16 = -2*t1;
double t17 = 3*t3;
double t18 = 3*t3*t6;
double t19 = t16 + t17 + t18;
double t20 = sin(th);
double t21 = pow(t20,2);
double t22 = 16*r*spin*t12*t19*t21;
double t27 = pow(r,3);
double t30 = pow(spin,4);
double t46 = pow(spin,6);
dg2[0][0] = 16*r*t12*(t2 - 3*t3 - 3*t3*t6);
dg2[0][1] = t15;
dg2[0][2] = 0;
dg2[0][3] = t22;
dg2[1][0] = t15;
dg2[1][1] = (2*(2*t27 - 3*t1*t3 + t30 - t3*(-4 + 6*r - 3*t1 + t3)*pow(cos(th),2)))/pow((-2 + r)*r + t3,3);
dg2[1][2] = 0;
dg2[1][3] = 0;
dg2[2][0] = 0;
dg2[2][1] = 0;
dg2[2][2] = 2;
dg2[2][3] = 0;
dg2[3][0] = t22;
dg2[3][1] = 0;
dg2[3][2] = 0;
dg2[3][3] = (t12*t21*(32*pow(r,6) + 48*pow(r,4)*t3 + 32*t27*t3 - 24*r*t30 + 36*t1*t30 + 10*t46 + t3*(16*(-2 + 3*r)*t27 + 48*t1*t3 + 15*t30)*t6 + 6*(2*r*(2 + r) + t3)*t30*cos(4*th) + t46*cos(6*th)))/2.;
}